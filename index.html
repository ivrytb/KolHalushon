<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>××¨×›×– ×”×©×™×¢×•×¨×™× - ×§×•×œ ×”×œ×©×•×Ÿ</title>
    <style>
        body { font-family: system-ui, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; direction: rtl; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .nav { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px 20px; background: #1a73e8; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; align-items: center; }
        .play-btn { color: green; font-weight: bold; cursor: pointer; border: 1px solid green; padding: 5px 10px; border-radius: 4px; }
        #player-box { display: none; margin-bottom: 20px; text-align: center; background: #000; padding: 10px; border-radius: 8px; }
        video { width: 100%; max-height: 400px; }
    </style>
</head>
<body>

<div class="container">
    <div id="player-box">
        <video id="v" controls autoplay crossorigin="anonymous"></video>
        <button onclick="document.getElementById('player-box').style.display='none'; v.pause();" style="background:#444; margin-top:5px;">×¡×’×•×¨ × ×’×Ÿ</button>
    </div>

    <div class="nav">
        <button onclick="load('LiveShiurim/WebSite_GetLiveShiurim/1/true/true/30/-1')" style="background: red;">ğŸ”´ ×©×™×“×•×¨×™× ×—×™×™×</button>
        <input type="text" id="q" placeholder="×—×¤×© ×¨×‘ (×œ××©×œ: ×‘×™×“×¨××Ÿ)...">
        <button onclick="search()">×—×¤×©</button>
    </div>

    <div id="list"></div>
</div>

<script>
    const PROXY = "/api/proxy?endpoint=";

    async function load(endpoint) {
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = "×˜×•×¢×Ÿ × ×ª×•× ×™×...";
        try {
            const res = await fetch(PROXY + encodeURIComponent(endpoint));
            const data = await res.json();
            render(data);
        } catch (e) {
            listDiv.innerHTML = "×©×’×™××” ×‘×˜×¢×™× ×”.";
        }
    }

    function search() {
        const val = document.getElementById('q').value;
        if(val) load(`Ravs/WebSite_GetRavs/1/${encodeURIComponent(val)}`);
    }

    function render(data) {
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = "";
        if(!data || data.length === 0) { listDiv.innerHTML = "××™×Ÿ ×ª×•×¦××•×ª."; return; }

        data.forEach(item => {
            const id = item.FileId || item.RavId;
            const name = item.UserNameHebrew || item.RavName || item.CatDesc1 || "×©×™×¢×•×¨";
            const isRav = !!item.RavId && !item.FileId;

            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `
                <span>${name}</span>
                <span class="play-btn" onclick="${isRav ? `load('Ravs/WebSite_GetRavShiurim/${id}/0/50/1/-1')` : `play('${id}', '${item.LivePubName || ''}')`}">
                    ${isRav ? '×œ×©×™×¢×•×¨×™× â†' : 'â–¶ × ×’×Ÿ'}
                </span>
            `;
            listDiv.appendChild(div);
        });
    }

    async function play(id, liveName) {
        const v = document.getElementById('v');
        const box = document.getElementById('player-box');
        let url = "";

        if (liveName && liveName.includes('@')) {
            // ×©×™×“×•×¨ ×—×™ - ×”×–×¨××” ×™×©×™×¨×”
            const channel = liveName.split('@')[0];
            url = `https://live.kolhalashon.com/live/${channel}/playlist.m3u8`;
        } else {
            // ×©×™×¢×•×¨ ××•×§×œ×˜ - ×©×™××•×© ×‘× ×ª×™×‘ ×©×¨××™× ×• ×‘"×”×’×–×¨×”" ××• ×‘× ×ª×™×‘ ×”×§×‘×¦×™×
            // × × ×¡×” ××ª ×”× ×ª×™×‘ ×”×›×™ ×¤×©×•×˜ ×©×¢×•×‘×“ ×‘× ×˜×¤×¨×™:
            url = `https://www.kolhalashon.com/api/files/GetMp3FileToPlay/${id}`;
        }

        box.style.display = 'block';
        v.src = url;
        v.play();
        window.scrollTo(0,0);
    }

    // ×˜×¢×™× ×” ×¨××©×•× ×™×ª ×©×œ ×©×™×“×•×¨×™× ×—×™×™×
    load('LiveShiurim/WebSite_GetLiveShiurim/1/true/true/30/-1');
</script>
</body>
</html>
