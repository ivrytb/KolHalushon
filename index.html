<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>专 砖注专</title>
    <style>
        :root { --primary: #1a3a5f; --secondary: #28a745; --bg: #f1f3f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; direction: rtl; }
        .container { max-width: 900px; margin: auto; }
        #player-box { position: sticky; top: 10px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); z-index: 1000; margin-bottom: 20px; display: none; text-align: center; }
        video { width: 100%; max-height: 350px; border-radius: 8px; background: #000; }
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: white; cursor: pointer; font-weight: bold; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .tab-btn.active { background: var(--primary); color: white; }
        .item-card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-right: 5px solid var(--primary); }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-play { background: var(--secondary); color: white; }
        #status { text-align: center; padding: 20px; color: #666; }
    </style>
</head>
<body>
<div class="container">
    <div id="player-box">
        <div id="playing-now" style="margin-bottom:10px; font-weight:bold;"></div>
        <video id="main-video" controls autoplay></video>
        <button class="btn" style="margin-top:10px; background:#eee;" onclick="closePlayer()">住专</button>
    </div>
    <div class="tabs">
        <button class="tab-btn active" onclick="loadLive()"> 砖专 </button>
        <button class="tab-btn" onclick="showSearch()"> 驻砖</button>
    </div>
    <div id="search-section" style="display:none; margin-bottom:20px;">
        <input type="text" id="search-query" style="width:70%; padding:10px;" placeholder="砖 专...">
        <button class="btn btn-play" onclick="searchRavs()">驻砖</button>
    </div>
    <div id="status">注...</div>
    <div id="content-list"></div>
</div>

<script>
    // 砖砖 驻专拽住 砖驻专 " 驻转 (Cors-Proxy)
    const PROXY = "https://corsproxy.io/?";
    const API_BASE = "https://www.kolhalashon.com/api/";

    async function callApi(endpoint) {
        const status = document.getElementById('status');
        status.innerText = "转拽砖专 注 砖专转...";
        try {
            // 住驻转 驻专拽住 驻 转转 砖 拽 砖
            const response = await fetch(PROXY + encodeURIComponent(API_BASE + endpoint));
            if (!response.ok) throw new Error("Status: " + response.status);
            const data = await response.json();
            status.innerText = "";
            return data;
        } catch (e) {
            console.error(e);
            status.innerText = "砖: 驻专 住 转 专 专. 住 砖 注 专注.";
            return null;
        }
    }

    async function loadLive() {
        hideSearch();
        const data = await callApi("LiveShiurim/WebSite_GetLiveShiurim/1/true/true/30/-1");
        render(data);
    }

    async function searchRavs() {
        const q = document.getElementById('search-query').value;
        const data = await callApi(`Ravs/WebSite_GetRavs/1/${encodeURIComponent(q)}`);
        const list = document.getElementById('content-list');
        list.innerHTML = '';
        data?.forEach(rav => {
            const d = document.createElement('div');
            d.className = 'item-card';
            d.innerHTML = `<span>${rav.RavName}</span><button class="btn btn-play" onclick="loadRav(${rav.RavId})">砖注专</button>`;
            list.appendChild(d);
        });
    }

    async function loadRav(id) {
        const data = await callApi(`Ravs/WebSite_GetRavShiurim/${id}/0/50/1/-1`);
        render(data);
    }

    function render(items) {
        const list = document.getElementById('content-list');
        list.innerHTML = '';
        if (!items || items.length === 0) return;
        items.forEach(item => {
            const title = item.Title || item.ShiurTitle;
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `<span>${title}</span><button class="btn btn-play" onclick="playMedia('${item.ShiurId || item.FileId}', '${title}')"></button>`;
            list.appendChild(card);
        });
    }

    async function playMedia(id, title) {
        const res = await callApi("files/getLocationOfFileToVideo/" + id);
        if(!res) return;
        const player = document.getElementById('main-video');
        document.getElementById('player-box').style.display = 'block';
        document.getElementById('playing-now').innerText = title;
        player.src = res.url || res;
        window.scrollTo(0,0);
    }

    function showSearch() { 
        document.getElementById('search-section').style.display = 'block';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    }
    function hideSearch() { document.getElementById('search-section').style.display = 'none'; }
    function closePlayer() { document.getElementById('player-box').style.display = 'none'; document.getElementById('main-video').pause(); }

    window.onload = loadLive;
</script>
</body>
</html>
