<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>××¨×›×– ×”×©×™×¢×•×¨×™×</title>
    <style>
        :root { --primary: #1a3a5f; --secondary: #28a745; --bg: #f1f3f6; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 20px; direction: rtl; }
        .container { max-width: 800px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; background: var(--secondary); color: white; font-weight: bold; }
        #player { display: none; background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        video { width: 100%; border-radius: 4px; background: #000; }
        input { padding: 10px; width: 200px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
<div class="container">
    <div id="player">
        <div id="title" style="margin-bottom:10px; font-weight:bold;"></div>
        <video id="v" controls autoplay></video>
        <button onclick="document.getElementById('player').style.display='none'; document.getElementById('v').pause();" style="margin-top:10px;">×¡×’×•×¨</button>
    </div>

    <div style="margin-bottom:20px;">
        <button onclick="load('LiveShiurim/WebSite_GetLiveShiurim/1/true/true/30/-1')">ğŸ”´ ×©×™×“×•×¨×™× ×—×™×™×</button>
        <input type="text" id="q" placeholder="×©× ×¨×‘...">
        <button onclick="search()">×—×¤×©</button>
    </div>

    <div id="st">×˜×•×¢×Ÿ...</div>
    <div id="list"></div>
</div>

<script>
    // ×”×›×ª×•×‘×ª ×”×™×—×¡×™×ª ×©×œ ×”-API ×©×œ×š ×‘×•×¨×¡×œ
    const PROXY = "/api/proxy?endpoint=";

    async function call(url) {
        document.getElementById('st').innerText = "×˜×•×¢×Ÿ × ×ª×•× ×™×...";
        try {
            const r = await fetch(PROXY + encodeURIComponent(url));
            const d = await r.json();
            document.getElementById('st').innerText = "";
            return d;
        } catch (e) {
            document.getElementById('st').innerText = "×©×’×™××” ×‘×—×™×‘×•×¨. ×•×•×“× ×©× ×˜×¤×¨×™ ××™×©×¨×• ××ª ×”×“×•××™×™×Ÿ ×©×œ ×•×¨×¡×œ.";
            return null;
        }
    }

    async function load(url) {
        const d = await call(url);
        const l = document.getElementById('list');
        l.innerHTML = '';
        d?.forEach(i => {
            const div = document.createElement('div');
            div.className = 'card';
            const title = i.Title || i.ShiurTitle || i.RavName;
            div.innerHTML = `<span>${title}</span><button class="btn" onclick="play('${i.ShiurId || i.FileId || i.RavId}', '${title}', ${!!i.RavId && !i.ShiurId})">${i.RavId && !i.ShiurId ? '×”×¦×’ ×©×™×¢×•×¨×™×' : 'â–¶ × ×’×Ÿ'}</button>`;
            l.appendChild(div);
        });
    }

    async function search() {
        const query = document.getElementById('q').value;
        load(`Ravs/WebSite_GetRavs/1/${encodeURIComponent(query)}`);
    }

    async function play(id, title, isRav) {
        if (isRav) {
            load(`Ravs/WebSite_GetRavShiurim/${id}/0/50/1/-1`);
            return;
        }
        const r = await call("files/getLocationOfFileToVideo/" + id);
        if (r) {
            document.getElementById('player').style.display = 'block';
            document.getElementById('title').innerText = title;
            document.getElementById('v').src = r.url || r;
            window.scrollTo(0,0);
        }
    }

    load('LiveShiurim/WebSite_GetLiveShiurim/1/true/true/30/-1');
</script>
</body>
</html>
